(function(){"use strict";var e;var i=function(s){e=this;s=s||{};e.fps=s.fps||0;e._original_baseline=s.baseline||"center";e.baseline=i.calcBaseline(e._original_baseline);e.sortLogics=s.sortLogics||false;e.idling=parseInt(s.idling)||0;e._dir="";e._logics=[];e._raf=null;e._prev_px_position=0;e._idle_rounds=0;window.addEventListener("resize",e.onResize.bind(e));window.addEventListener("scroll",e.onScroll.bind(e))};i.prototype.add=function(e,s,r){e.id=e.id||"lid_"+this._logics.length;this._logics.push(new i.Logic(e,s,r));return this};i.prototype.remove=function(e){for(var i=0;i<this._logics.length;i++){if(this._logics[i].id===e){this._logics.splice(i,1);return this}}return this};i.prototype.sort=function(){this._logics.sort(function(e,i){return e.order-i.order});return this};i.Logic=function(s,r,t){e.id=s.id;e.el=s.el;e.order=s.order||0;e.callback=r;e.callbackArgs=t||[];e.range=s.range||null;e.baseline=s.baseline||0;e.nodelist=document.querySelectorAll(s.el);e.units=[];for(var n=0;n<e.nodelist.length;n++){e.units[n]=new i.Unit({el:e.nodelist[n],baseline:i.calcBaseline(e.baseline,e.nodelist[n]),progress:new i.Position})}e._range_unit;if(e.range){if(typeof e.range[0]==="string"){if(e.range[0].indexOf("%")!==-1){e.range[0]=parseFloat(e.range[0].replace("%",""))/100;e.range[1]=parseFloat(e.range[1].replace("%",""))/100;e._range_unit="dc"}else{e._range_unit="px"}}else{e._range_unit="px"}}};i.Unit=function(e){this.el=e.el;this.baseline=e.baseline;this.progress=e.progress;this._top_edge_rendered=false;this._bot_edge_rendered=false;this.maps=e.maps||{}};i.Unit.prototype.map=function(e,i,s,r){e=e.toString();i.to=i.to||[0,1];r=r||[];this.maps[e]=this.maps[e]||{_top_edge_rendered:false,_bot_edge_rendered:false};var t=i.from[0],n=i.from[1],o=i.to[0],l=i.to[1],a,p;if(typeof t==="string"){if(t.indexOf("%")!==-1){a="pc";t=parseFloat(t.replace("%",""));n=parseFloat(n.replace("%",""))}else{a="px"}}else{a="px"}var d=this.progress[a];var g=this.maps[e];if(t<=d&&d<=n){g._top_edge_rendered=false;g._bot_edge_rendered=false;p=(d-t)/(n-t)*(l-o)+o;r.unshift(p);s.apply(this,r)}else{if(d<t){g._bot_edge_rendered=false;if(!g._top_edge_rendered){g._top_edge_rendered=true;d=t;p=(d-t)/(n-t)*(l-o)+o;r.unshift(p);s.apply(this,r)}}else{g._top_edge_rendered=false;if(!g._bot_edge_rendered){g._bot_edge_rendered=true;d=n;p=(d-t)/(n-t)*(l-o)+o;r.unshift(p);s.apply(this,r)}}}};i.Position=function(e){e=e||{};this.px=e.px||undefined;this.dc=e.dc||undefined;this.pc=e.pc||undefined};i.Position.prototype.compareTo=function(e){return new i.Position};i.prototype.run=function(){this._raf=window.requestAnimationFrame(this._engine.bind(this));return this};i.prototype.pause=function(){window.cancelAnimationFrame(this._raf);this._raf=null;return this};i.prototype._engine=function(){console.log(this._prev_px_position,window.pageYOffset);if(this._prev_px_position===window.pageYOffset){if(this._dir==="stay"){if(this.idling>=0)this._idle_rounds++}else if(this._dir===""){this._dir="initialized"}else{this._dir="stay"}}else{this._idle_rounds=0;if(this._prev_px_position<window.pageYOffset)this._dir="down";else this._dir="up"}console.log(this._dir);if(this.idling<0||this.idling===0&&this._dir!=="stay"||this._idle_rounds<this.idling){for(var e=0;e<this._logics.length;e++){var i=this._logics[e];for(var s=0;s<i.units.length;s++){var r=i.units[s];var t=r.el.getBoundingClientRect();r.progress.px=this.baseline.px-(t.top+r.baseline.px);r.progress.dc=t.height===0?0:r.progress.px/t.height;r.progress.pc=r.progress.dc*100;if(i.range){if(i.range[0]<=r.progress[i._range_unit]&&r.progress[i._range_unit]<=i.range[1]){r._top_edge_rendered=false;r._bot_edge_rendered=false;i.callback.apply(r,i.callbackArgs)}else{if(r.progress[i._range_unit]<i.range[0]){r._bot_edge_rendered=false;if(i._range_unit==="px"){r.progress.px=i.range[0];r.progress.dc=t.height===0?0:r.progress.px/t.height;r.progress.pc=r.progress.dc*100}else{r.progress.dc=i.range[0];r.progress.px=t.height*r.progress.dc;r.progress.pc=r.progress.dc*100}if(!r._top_edge_rendered){r._top_edge_rendered=true;i.callback.apply(r,i.callbackArgs)}else{}}else{r._top_edge_rendered=false;if(i._range_unit==="px"){r.progress.px=i.range[1];r.progress.dc=t.height===0?0:r.progress.px/t.height;r.progress.pc=r.progress.dc*100}else{r.progress.dc=i.range[1];r.progress.px=t.height*r.progress.dc;r.progress.pc=r.progress.dc*100}if(!r._bot_edge_rendered){r._bot_edge_rendered=true;i.callback.apply(r,i.callbackArgs)}else{}}}}else{i.callback.apply(r,i.callbackArgs)}}}this._prev_px_position=window.pageYOffset;this.run()}else{if(this._raf)this.pause()}};i.prototype.onResize=function(e){console.log("res");this.baseline=i.calcBaseline(this._original_baseline);for(var s=0;s<this._logics.length;s++){var r=this._logics[s];for(var t=0;t<r.units.length;t++){var n=r.units[t];n.baseline=i.calcBaseline(r.baseline,n.el)}}this.run()};i.prototype.onScroll=function(e){this.run()};i.calcBaseline=function(e,s){var r=new i.Position;var t=s?s.getBoundingClientRect().height:window.innerHeight;switch(e){case"top":r.px=0;r.dc=0;r.pc=0;break;case"center":r.px=t/2;r.dc=.5;r.pc=50;break;case"bottom":r.px=t;r.dc=1;r.pc=100;break;default:if(typeof e==="string"){if(e.indexOf("%")!==-1){r.pc=parseFloat(e.replace("%",""));r.dc=r.pc/100;r.px=t*r.dc}else{n()}}else{n()}function n(){r.px=parseFloat(e);r.dc=e/t;r.pc=e/t*100}break}return r};i.Util={};if(typeof define==="function"&&define.amd)define(i);else if(typeof module==="object"&&module.exports)module.exports=i;else this.Scrawler=i}).call(this);