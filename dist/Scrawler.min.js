(function(){"use strict";var e;var r=function(i){e=this;i=i||{};e.fps=i.fps||0;e._original_baseline=i.baseline||"center";e.baseline=r.calcBaseline(e._original_baseline);e.sortLogics=i.sortLogics||false;e.idling=parseInt(i.idling)||0;e._dir="";e._logics=[];e._raf=null;e._prev_px_position=0;e._idle_rounds=0;e._scroll_event_initialized=false;window.addEventListener("resize",e.refresh)};r.prototype.add=function(i,n,s){i.id=i.id||"lid_"+e._logics.length;e._logics.push(new r.Logic(i,n,s));return e};r.prototype.remove=function(r){for(var i=0;i<e._logics.length;i++){if(e._logics[i].id===r){e._logics.splice(i,1);return e}}return e};r.prototype.sort=function(){e._logics.sort(function(e,r){return e.order-r.order});return e};r.Logic=function(e,i,n){var s=this;s.id=e.id;s.el=e.el;s.order=e.order||0;s.callback=i;s.callbackArgs=n||[];s.range=e.range||null;s.baseline=e.baseline||0;s.nodelist=document.querySelectorAll(e.el);s.units=[];for(var o=0;o<s.nodelist.length;o++){s.units[o]=new r.Unit({el:s.nodelist[o],baseline:r.calcBaseline(s.baseline,s.nodelist[o]),progress:new r.Position})}s._range_unit;if(s.range){if(typeof s.range[0]==="string"){if(s.range[0].indexOf("%")!==-1){s.range[0]=parseFloat(s.range[0].replace("%",""))/100;s.range[1]=parseFloat(s.range[1].replace("%",""))/100;s._range_unit="dc"}else{s._range_unit="px"}}else{s._range_unit="px"}}};r.Unit=function(e){var r=this;r.el=e.el;r.baseline=e.baseline;r.progress=e.progress;r._top_edge_rendered=false;r._bot_edge_rendered=false;r.maps=e.maps||{}};r.Unit.prototype.map=function(e,r,i,n){var s=this;e=e.toString();r.to=r.to||[0,1];n=n||[];s.maps[e]=s.maps[e]||{_top_edge_rendered:false,_bot_edge_rendered:false};var o=r.from[0],t=r.from[1],a=r.to[0],l=r.to[1],p,d;if(typeof o==="string"){if(o.indexOf("%")!==-1){p="pc";o=parseFloat(o.replace("%",""));t=parseFloat(t.replace("%",""))}else{p="px"}}else{p="px"}var _=s.progress[p];var g=s.maps[e];if(o<=_&&_<=t){g._top_edge_rendered=false;g._bot_edge_rendered=false;d=(_-o)/(t-o)*(l-a)+a;n.unshift(d);i.apply(s,n)}else{if(_<o){g._bot_edge_rendered=false;if(!g._top_edge_rendered){g._top_edge_rendered=true;_=o;d=(_-o)/(t-o)*(l-a)+a;n.unshift(d);i.apply(s,n)}}else{g._top_edge_rendered=false;if(!g._bot_edge_rendered){g._bot_edge_rendered=true;_=t;d=(_-o)/(t-o)*(l-a)+a;n.unshift(d);i.apply(s,n)}}}};r.Position=function(e){var r=this;e=e||{};r.px=e.px||undefined;r.dc=e.dc||undefined;r.pc=e.pc||undefined};r.Position.prototype.compareTo=function(e){return new r.Position};r.prototype.watch=function(r){if(!r){n();s();e._prev_px_position=window.pageYOffset}return e};r.prototype.run=function(){if(!e._scroll_event_initialized){e._scroll_event_initialized=true;window.addEventListener("scroll",e.run)}e._raf=window.requestAnimationFrame(i);return e};r.prototype.pause=function(){window.cancelAnimationFrame(e._raf);e._raf=null;return e};function i(){n();if(e.idling<0||e.idling===0&&e._dir!=="stay"||e._idle_rounds<e.idling){s();e._prev_px_position=window.pageYOffset;e._raf=window.requestAnimationFrame(i)}else{if(e._raf)e.pause()}}function n(r){if(r){e._dir="resizing"}else{if(e._prev_px_position===window.pageYOffset){if(e._dir==="stay"){if(e.idling>=0)e._idle_rounds++}else if(e._dir===""){e._dir="initialized"}else{e._dir="stay"}}else{e._idle_rounds=0;if(e._prev_px_position<window.pageYOffset)e._dir="down";else e._dir="up"}}}function s(){for(var r=0;r<e._logics.length;r++){var i=e._logics[r];for(var n=0;n<i.units.length;n++){var s=i.units[n];var o=s.el.getBoundingClientRect();s.progress.px=e.baseline.px-(o.top+s.baseline.px);s.progress.dc=o.height===0?0:s.progress.px/o.height;s.progress.pc=s.progress.dc*100;if(i.range){if(i.range[0]<=s.progress[i._range_unit]&&s.progress[i._range_unit]<=i.range[1]){s._top_edge_rendered=false;s._bot_edge_rendered=false;i.callback.apply(s,i.callbackArgs)}else{if(s.progress[i._range_unit]<i.range[0]){s._bot_edge_rendered=false;if(i._range_unit==="px"){s.progress.px=i.range[0];s.progress.dc=o.height===0?0:s.progress.px/o.height;s.progress.pc=s.progress.dc*100}else{s.progress.dc=i.range[0];s.progress.px=o.height*s.progress.dc;s.progress.pc=s.progress.dc*100}if(!s._top_edge_rendered){s._top_edge_rendered=true;i.callback.apply(s,i.callbackArgs)}else{}}else{s._top_edge_rendered=false;if(i._range_unit==="px"){s.progress.px=i.range[1];s.progress.dc=o.height===0?0:s.progress.px/o.height;s.progress.pc=s.progress.dc*100}else{s.progress.dc=i.range[1];s.progress.px=o.height*s.progress.dc;s.progress.pc=s.progress.dc*100}if(!s._bot_edge_rendered){s._bot_edge_rendered=true;i.callback.apply(s,i.callbackArgs)}else{}}}}else{i.callback.apply(s,i.callbackArgs)}}}}r.prototype.refresh=function(i){n(true);e.baseline=r.calcBaseline(e._original_baseline);for(var o=0;o<e._logics.length;o++){var t=e._logics[o];for(var a=0;a<t.units.length;a++){var l=t.units[a];l.baseline=r.calcBaseline(t.baseline,l.el)}}s();e._prev_px_position=window.pageYOffset};r.calcBaseline=function(e,i){var n=new r.Position;var s=i?i.getBoundingClientRect().height:window.innerHeight;switch(e){case"top":n.px=0;n.dc=0;n.pc=0;break;case"center":n.px=s/2;n.dc=.5;n.pc=50;break;case"bottom":n.px=s;n.dc=1;n.pc=100;break;default:if(typeof e==="string"){if(e.indexOf("%")!==-1){n.pc=parseFloat(e.replace("%",""));n.dc=n.pc/100;n.px=s*n.dc}else{o()}}else{o()}function o(){n.px=parseFloat(e);n.dc=e/s;n.pc=e/s*100}break}return n};r.Util={};if(typeof define==="function"&&define.amd)define(r);else if(typeof module==="object"&&module.exports)module.exports=r;else this.Scrawler=r}).call(this);