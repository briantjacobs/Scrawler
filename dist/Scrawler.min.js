(function(){"use strict";var e=function(i){this.fps=i.fps||0;this.baseline=e.calcBaseline(i.baseline||"center");this.sortLogics=i.sortLogics||false;this.logics=i.logics||[];this.idling=parseInt(i.idling)||0;this.direction="";this._raf=null;this._prev_px_position=0;this._idle_rounds=0;window.addEventListener("resize",this.onResize.bind(this));window.addEventListener("scroll",this.onScroll.bind(this))};e.Logic=function(i,s,t){this.lid=i.lid;this.el=i.el;this.order=i.order||0;this.callback=s;this.callbackArgs=t||[];this.range=i.range||null;this.baseline=i.baseline||"center";this.nodelist=document.querySelectorAll(i.el);this.units=[];for(var r=0;r<this.nodelist.length;r++){this.units[r]=new e.Unit({el:this.nodelist[r],baseline:e.calcBaseline(this.baseline,this.nodelist[r]),progress:new e.Position})}this._range_unit;if(this.range){if(typeof this.range[0]==="string"){if(this.range[0].indexOf("%")!==-1){this.range[0]=parseFloat(this.range[0].replace("%",""))/100;this.range[1]=parseFloat(this.range[1].replace("%",""))/100;this._range_unit="dc"}else{this._range_unit="px"}}else{this._range_unit="px"}}};e.Unit=function(e){this.el=e.el;this.baseline=e.baseline;this.progress=e.progress;this._top_edge_rendered=false;this._bot_edge_rendered=false};e.Map=function(e,i,s){this.from=e.from;this.to=e.to||[0,1];this.callback=i;this.callbackArgs=s};e.Unit.prototype.map=function(e,i,s){e.to=e.to||[0,1];s=s||[];var t=e.from[0],r=e.from[1],n=e.to[0],o=e.to[1],l,p;if(typeof t==="string"){if(t.indexOf("%")!==-1){l="pc";t=parseFloat(t.replace("%",""));r=parseFloat(r.replace("%",""))}else{l="px"}}else{l="px"}var a=this.progress[l];if(a<t)a=t;else if(a>r)a=r;console.log(a);p=(a-t)/(r-t)*(o-n)+n;s.unshift(p);i.apply(this,s)};e.Position=function(e){e=e||{};this.px=e.px||undefined;this.dc=e.dc||undefined;this.pc=e.pc||undefined};e.Position.prototype.compareTo=function(i){return new e.Position};e.prototype.add=function(i,s,t){i.lid=i.lid||"lid_"+this.logics.length;this.logics.push(new e.Logic(i,s,t));return this};e.prototype.remove=function(e){for(var i=0;i<this.logics.length;i++){if(this.logics[i].lid===e){this.logics.splice(i,1);return this}}return this};e.prototype.sort=function(){this.logics.sort(function(e,i){return e.order-i.order});return this};e.prototype.run=function(){this._raf=window.requestAnimationFrame(this._engine.bind(this));return this};e.prototype.pause=function(){window.cancelAnimationFrame(this._raf);this._raf=null;return this};e.prototype._engine=function(){if(this._prev_px_position===window.pageYOffset){if(this.direction==="stay"){if(this.idling>=0)this._idle_rounds++}else if(this.direction===""){this.direction="initialized"}else{this.direction="stay"}}else{this._idle_rounds=0;if(this._prev_px_position<window.pageYOffset)this.direction="down";else this.direction="up"}if(this.idling<0||this.idling===0&&this.direction!=="stay"||this._idle_rounds<this.idling){for(var e=0;e<this.logics.length;e++){var i=this.logics[e];for(var s=0;s<i.units.length;s++){var t=i.units[s];var r=t.el.getBoundingClientRect();t.progress.px=this.baseline.px-(r.top+t.baseline.px);t.progress.dc=r.height===0?0:t.progress.px/r.height;t.progress.pc=t.progress.dc*100;if(i.range){if(i.range[0]<=t.progress[i._range_unit]&&t.progress[i._range_unit]<=i.range[1]){t._top_edge_rendered=false;t._bot_edge_rendered=false;i.callback.apply(t,i.callbackArgs)}else{if(t.progress[i._range_unit]<i.range[0]){t._bot_edge_rendered=false;if(i._range_unit==="px"){t.progress.px=i.range[0];t.progress.dc=r.height===0?0:t.progress.px/r.height;t.progress.pc=t.progress.dc*100}else{t.progress.dc=i.range[0];t.progress.px=r.height*t.progress.dc;t.progress.pc=t.progress.dc*100}if(!t._top_edge_rendered){t._top_edge_rendered=true;i.callback.apply(t,i.callbackArgs)}else{}}else{t._top_edge_rendered=false;if(i._range_unit==="px"){t.progress.px=i.range[1];t.progress.dc=r.height===0?0:t.progress.px/r.height;t.progress.pc=t.progress.dc*100}else{t.progress.dc=i.range[1];t.progress.px=r.height*t.progress.dc;t.progress.pc=t.progress.dc*100}if(!t._bot_edge_rendered){t._bot_edge_rendered=true;i.callback.apply(t,i.callbackArgs)}else{}}}}else{i.callback.apply(t,i.callbackArgs)}}}this._prev_px_position=window.pageYOffset;this.run()}else{if(this._raf)this.pause()}};e.prototype.onResize=function(e){};e.prototype.onScroll=function(e){this.run()};e.calcBaseline=function(i,s){var t=new e.Position;var r=s?s.getBoundingClientRect().height:window.innerHeight;switch(i){case"top":t.px=0;t.dc=0;t.pc=0;break;case"center":t.px=Math.round(r/2);t.dc=.5;t.pc=50;break;case"bottom":t.px=r;t.dc=1;t.pc=100;break;default:if(typeof i==="string"){if(i.indexOf("%")!==-1){t.pc=parseFloat(i.replace("%",""));t.dc=t.pc/100;t.px=Math.round(r*t.dc)}else{n()}}else{n()}function n(){t.px=Math.round(parseFloat(i));t.dc=i/r;t.pc=i/r*100}break}return t};e.Util={};if(typeof define==="function"&&define.amd)define(e);else if(typeof module==="object"&&module.exports)module.exports=e;this.Scrawler=e}).call(this);