(function(){"use strict";var e;var r=function(i){e=this;i=i||{};e.fps=i.fps||0;e._original_baseline=i.baseline||"center";e.baseline=r.calcBaseline(e._original_baseline);e.sortLogics=i.sortLogics||false;e.idling=parseInt(i.idling)||0;e._dir="";e._logics=[];e._raf=null;e._prev_px_position=0;e._idle_rounds=0;window.addEventListener("resize",e.onResize.bind(e));window.addEventListener("scroll",e.onScroll.bind(e))};r.prototype.add=function(e,i,s){e.id=e.id||"lid_"+this._logics.length;this._logics.push(new r.Logic(e,i,s));return this};r.prototype.remove=function(e){for(var r=0;r<this._logics.length;r++){if(this._logics[r].id===e){this._logics.splice(r,1);return this}}return this};r.prototype.sort=function(){this._logics.sort(function(e,r){return e.order-r.order});return this};r.Logic=function(e,i,s){var n=this;n.id=e.id;n.el=e.el;n.order=e.order||0;n.callback=i;n.callbackArgs=s||[];n.range=e.range||null;n.baseline=e.baseline||0;n.nodelist=document.querySelectorAll(e.el);n.units=[];for(var t=0;t<n.nodelist.length;t++){n.units[t]=new r.Unit({el:n.nodelist[t],baseline:r.calcBaseline(n.baseline,n.nodelist[t]),progress:new r.Position})}n._range_unit;if(n.range){if(typeof n.range[0]==="string"){if(n.range[0].indexOf("%")!==-1){n.range[0]=parseFloat(n.range[0].replace("%",""))/100;n.range[1]=parseFloat(n.range[1].replace("%",""))/100;n._range_unit="dc"}else{n._range_unit="px"}}else{n._range_unit="px"}}};r.Unit=function(e){this.el=e.el;this.baseline=e.baseline;this.progress=e.progress;this._top_edge_rendered=false;this._bot_edge_rendered=false;this.maps=e.maps||{}};r.Unit.prototype.map=function(e,r,i,s){e=e.toString();r.to=r.to||[0,1];s=s||[];this.maps[e]=this.maps[e]||{_top_edge_rendered:false,_bot_edge_rendered:false};var n=r.from[0],t=r.from[1],o=r.to[0],a=r.to[1],l,p;if(typeof n==="string"){if(n.indexOf("%")!==-1){l="pc";n=parseFloat(n.replace("%",""));t=parseFloat(t.replace("%",""))}else{l="px"}}else{l="px"}var d=this.progress[l];var g=this.maps[e];if(n<=d&&d<=t){g._top_edge_rendered=false;g._bot_edge_rendered=false;p=(d-n)/(t-n)*(a-o)+o;s.unshift(p);i.apply(this,s)}else{if(d<n){g._bot_edge_rendered=false;if(!g._top_edge_rendered){g._top_edge_rendered=true;d=n;p=(d-n)/(t-n)*(a-o)+o;s.unshift(p);i.apply(this,s)}}else{g._top_edge_rendered=false;if(!g._bot_edge_rendered){g._bot_edge_rendered=true;d=t;p=(d-n)/(t-n)*(a-o)+o;s.unshift(p);i.apply(this,s)}}}};r.Position=function(e){e=e||{};this.px=e.px||undefined;this.dc=e.dc||undefined;this.pc=e.pc||undefined};r.Position.prototype.compareTo=function(e){return new r.Position};r.prototype.run=function(){this._raf=window.requestAnimationFrame(this._engine.bind(this));return this};r.prototype.pause=function(){window.cancelAnimationFrame(this._raf);this._raf=null;return this};r.prototype._engine=function(){i();if(e.idling<0||e.idling===0&&e._dir!=="stay"||e._idle_rounds<e.idling){s();e._prev_px_position=window.pageYOffset;e.run()}else{if(e._raf)e.pause()}};function i(r){if(r){e._dir="resizing"}else{if(e._prev_px_position===window.pageYOffset){if(e._dir==="stay"){if(e.idling>=0)e._idle_rounds++}else if(e._dir===""){e._dir="initialized"}else{e._dir="stay"}}else{e._idle_rounds=0;if(e._prev_px_position<window.pageYOffset)e._dir="down";else e._dir="up"}}}function s(){for(var r=0;r<e._logics.length;r++){var i=e._logics[r];for(var s=0;s<i.units.length;s++){var n=i.units[s];var t=n.el.getBoundingClientRect();n.progress.px=e.baseline.px-(t.top+n.baseline.px);n.progress.dc=t.height===0?0:n.progress.px/t.height;n.progress.pc=n.progress.dc*100;if(i.range){if(i.range[0]<=n.progress[i._range_unit]&&n.progress[i._range_unit]<=i.range[1]){n._top_edge_rendered=false;n._bot_edge_rendered=false;i.callback.apply(n,i.callbackArgs)}else{if(n.progress[i._range_unit]<i.range[0]){n._bot_edge_rendered=false;if(i._range_unit==="px"){n.progress.px=i.range[0];n.progress.dc=t.height===0?0:n.progress.px/t.height;n.progress.pc=n.progress.dc*100}else{n.progress.dc=i.range[0];n.progress.px=t.height*n.progress.dc;n.progress.pc=n.progress.dc*100}if(!n._top_edge_rendered){n._top_edge_rendered=true;i.callback.apply(n,i.callbackArgs)}else{}}else{n._top_edge_rendered=false;if(i._range_unit==="px"){n.progress.px=i.range[1];n.progress.dc=t.height===0?0:n.progress.px/t.height;n.progress.pc=n.progress.dc*100}else{n.progress.dc=i.range[1];n.progress.px=t.height*n.progress.dc;n.progress.pc=n.progress.dc*100}if(!n._bot_edge_rendered){n._bot_edge_rendered=true;i.callback.apply(n,i.callbackArgs)}else{}}}}else{i.callback.apply(n,i.callbackArgs)}}}}r.prototype.onResize=function(n){i(true);e.baseline=r.calcBaseline(e._original_baseline);for(var t=0;t<e._logics.length;t++){var o=e._logics[t];for(var a=0;a<o.units.length;a++){var l=o.units[a];l.baseline=r.calcBaseline(o.baseline,l.el)}}s();e._prev_px_position=window.pageYOffset};r.prototype.onScroll=function(e){this.run()};r.calcBaseline=function(e,i){var s=new r.Position;var n=i?i.getBoundingClientRect().height:window.innerHeight;switch(e){case"top":s.px=0;s.dc=0;s.pc=0;break;case"center":s.px=n/2;s.dc=.5;s.pc=50;break;case"bottom":s.px=n;s.dc=1;s.pc=100;break;default:if(typeof e==="string"){if(e.indexOf("%")!==-1){s.pc=parseFloat(e.replace("%",""));s.dc=s.pc/100;s.px=n*s.dc}else{t()}}else{t()}function t(){s.px=parseFloat(e);s.dc=e/n;s.pc=e/n*100}break}return s};r.Util={};if(typeof define==="function"&&define.amd)define(r);else if(typeof module==="object"&&module.exports)module.exports=r;else this.Scrawler=r}).call(this);